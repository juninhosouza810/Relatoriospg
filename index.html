<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Relat√≥rio de Ronda - CPI-10 | Firebase Edition</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-box h1 {
            color: #003366;
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        .login-box h2 {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
            font-weight: normal;
        }

        .login-box .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .login-box input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
        }

        .btn-login {
            width: 100%;
            padding: 14px;
            background: #003366;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-login:hover {
            background: #004080;
        }

        .btn-register {
            width: 100%;
            padding: 14px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        .error-msg {
            color: #dc3545;
            font-size: 0.9em;
            margin-top: 10px;
            display: none;
        }

        .user-info {
            background: #003366;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-logout {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .edit-mode {
            padding: 30px;
            background: #f8f9fa;
            display: none;
        }

        .header-edit {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #003366;
            color: white;
            border-radius: 8px;
        }

        .form-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #003366;
        }

        .form-section h3 {
            color: #003366;
            margin-bottom: 15px;
            font-size: 1.2em;
            text-transform: uppercase;
            border-bottom: 2px solid #003366;
            padding-bottom: 5px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #555;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 0.95em;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #003366;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .btn-primary { background: #003366; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #000; }
        .btn-danger { background: #dc3545; color: white; }

        .print-mode {
            display: none;
            padding: 20px;
            background: white;
            font-family: "Times New Roman", Times, serif;
            font-size: 11pt;
            line-height: 1.2;
        }

        .official-header {
            display: grid;
            grid-template-columns: 100px 1fr 2fr;
            gap: 0;
            border: 2px solid black;
            margin-bottom: 0;
        }

        .official-header .logo-area {
            border-right: 2px solid black;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
            background: white;
            min-height: 100px;
        }

        .brasao-fallback {
            width: 85px;
            height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 10px;
            font-weight: bold;
            color: #003366;
            border: 1px solid #003366;
            background: #f0f0f0;
        }

        .official-header .pm-text {
            border-right: 2px solid black;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-weight: bold;
            font-size: 11pt;
            padding: 10px;
            line-height: 1.3;
        }

        .official-header .doc-title {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-weight: bold;
            font-size: 12pt;
            text-decoration: underline;
            padding: 10px;
        }

        .date-line {
            border: 2px solid black;
            border-top: none;
            padding: 8px;
            text-align: right;
            margin-bottom: 15px;
            font-size: 11pt;
        }

        table.official-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            font-size: 10pt;
        }

        table.official-table th,
        table.official-table td {
            border: 1px solid black;
            padding: 6px;
            vertical-align: top;
        }

        table.official-table th {
            background: #f0f0f0;
            font-weight: bold;
            text-align: center;
        }

        .section-title {
            background: #e0e0e0;
            font-weight: bold;
            text-align: center;
            font-size: 11pt;
        }

        .signature-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
            border: 2px solid black;
            padding: 10px;
        }

        .signature-box {
            text-align: center;
            font-size: 9pt;
        }

        .signature-line {
            border-top: 1px solid black;
            margin-top: 40px;
            padding-top: 5px;
        }

        .observations-box {
            border: 2px solid black;
            min-height: 300px;
            margin-top: 15px;
        }

        .observations-title {
            background: #f0f0f0;
            border-bottom: 1px solid black;
            padding: 5px;
            font-weight: bold;
            text-align: center;
        }

        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; max-width: 100%; }
            .edit-mode, .login-screen, .user-info { display: none !important; }
            .print-mode { display: block !important; padding: 10mm; }
            .no-print { display: none !important; }
            @page { size: A4; margin: 10mm; }
        }

        .saved-reports {
            margin-top: 20px;
            padding: 15px;
            background: #e9ecef;
            border-radius: 6px;
        }

        .report-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            margin-bottom: 8px;
            border-radius: 4px;
            border-left: 3px solid #003366;
        }

        .report-title { font-weight: 600; color: #003366; }
        .report-date { font-size: 0.85em; color: #666; }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8em;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #003366;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border-radius: 6px;
            font-size: 0.9em;
            display: none;
            z-index: 1000;
        }

        .sync-status.show { display: block; }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        /* OCULTO: Informa√ß√µes de debug/isolamento n√£o vis√≠veis para o usu√°rio */
        .user-isolation-warning {
            display: none; /* OCULTO - mantido apenas para debug se necess√°rio */
        }

        /* Simplificado: Apenas indicador de status do relat√≥rio */
        .report-status {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 10px 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-weight: 600;
            color: #1976d2;
        }

        .report-status.editing {
            background: #fff3e0;
            border-left-color: #ff9800;
            color: #f57c00;
        }
    </style>
</head>
<body>
    <!-- TELA DE LOGIN -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h1>üöî CPI-10</h1>
            <h2>Sistema de Relat√≥rios de Ronda</h2>
            
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="loginEmail" placeholder="seu.email@pm.sp.gov.br">
            </div>
            
            <div class="form-group">
                <label>Senha:</label>
                <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            
            <button class="btn-login" onclick="login()">Entrar</button>
            <button class="btn-register" onclick="register()">Criar Nova Conta</button>
            
            <div class="error-msg" id="loginError"></div>
        </div>
    </div>

    <!-- √ÅREA LOGADA -->
    <div class="container" id="appContainer" style="display: none;">
        <div class="user-info">
            <div>
                <span id="userName">Usu√°rio</span> | 
                <small id="userEmail">email@pm.sp.gov.br</small>
                <!-- OCULTO: UID n√£o exibido na interface -->
                <small id="userUid" style="display: none;"></small>
            </div>
            <button class="btn-logout" onclick="logout()">Sair</button>
        </div>

        <div class="edit-mode" id="editMode">
            <!-- OCULTO: Aviso de isolamento removido da interface -->
            <div class="user-isolation-warning">
                üîí Modo Isolado: Voc√™ s√≥ tem acesso aos seus pr√≥prios relat√≥rios. 
                ID do usu√°rio: <span id="displayUid"></span>
            </div>

            <!-- Simplificado: Apenas indicador de status do relat√≥rio -->
            <div id="reportStatusIndicator" class="report-status">
                üìù Novo Relat√≥rio - Preencha os dados abaixo
            </div>

            <div class="header-edit">
                <h1>üöî Sistema de Relat√≥rio de Ronda</h1>
                <h2>Oficial Superior/Supervisor do CPI-10</h2>
            </div>

            <!-- Dados B√°sicos -->
            <div class="form-section">
                <h3>üìã Dados da Ronda</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Data:</label>
                        <input type="date" id="dataRonda" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Turno de:</label>
                        <input type="time" id="turnoInicio" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>√Äs:</label>
                        <input type="time" id="turnoFim" onchange="updatePreview()">
                    </div>
                </div>
                
                <h4 style="margin-top: 15px; color: #555;">Dados da Viatura</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Viatura (Prefixo):</label>
                        <input type="text" id="viatura" placeholder="Ex: CPI-10123" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Posto/Gradua√ß√£o:</label>
                        <input type="text" id="postoGrad" placeholder="Ex: Capit√£o" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>RE/DC:</label>
                        <input type="text" id="reDc" placeholder="N√∫mero RE" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Nome de Guerra:</label>
                        <input type="text" id="nomeGuerra" placeholder="Nome de Guerra" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Km In√≠cio:</label>
                        <input type="number" id="kmInicio" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Km Final:</label>
                        <input type="number" id="kmFinal" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Km Percorrido:</label>
                        <input type="number" id="kmPercorrido" readonly>
                    </div>
                </div>

                <h4 style="margin-top: 15px; color: #555;">Dados da Tripula√ß√£o</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Motorista RE:</label>
                        <input type="text" id="motRe" placeholder="RE do Motorista" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Motorista Nome de Guerra:</label>
                        <input type="text" id="motNomeGuerra" placeholder="Nome de Guerra do Motorista" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Auxiliar RE:</label>
                        <input type="text" id="auxRe" placeholder="RE do Auxiliar" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Auxiliar Nome de Guerra:</label>
                        <input type="text" id="auxNomeGuerra" placeholder="Nome de Guerra do Auxiliar" onchange="updatePreview()">
                    </div>
                </div>
            </div>

            <!-- OPM 1 -->
            <div class="form-section">
                <h3>üè¢ OPM Rondada - 1</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Btl/Cia PM/Pel/Gp:</label>
                        <input type="text" id="opm1Unidade" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Munic√≠pio:</label>
                        <input type="text" id="opm1Municipio" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Hora Chegada:</label>
                        <input type="time" id="opm1Chegada" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Hora Sa√≠da:</label>
                        <input type="time" id="opm1Saida" onchange="updatePreview()">
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 10px;">
                    <label>1. Policiais de Servi√ßo (Posto/Grad/RE/Nome):</label>
                    <textarea id="opm1Policiais" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>1.1. Apresenta√ß√£o pessoal e EPI:</label>
                    <textarea id="opm1Epi" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>2. √Årea externa da OPM:</label>
                    <textarea id="opm1AreaExterna" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>3. Servi√ßo de Dia e √°reas comuns internas:</label>
                    <textarea id="opm1ServicoDia" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>4. Reserva de armas:</label>
                    <textarea id="opm1ReservaArmas" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>5. Vesti√°rios:</label>
                    <textarea id="opm1Vestiarios" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>6. Copa/cozinha:</label>
                    <textarea id="opm1Copa" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>7. Garagens:</label>
                    <textarea id="opm1Garagens" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>8. √Årea de lazer:</label>
                    <textarea id="opm1Lazer" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>9. Outros itens/Observa√ß√µes:</label>
                    <textarea id="opm1Outros" rows="2" onchange="updatePreview()"></textarea>
                </div>
            </div>

            <!-- OPM 2 -->
            <div class="form-section">
                <h3>üè¢ OPM Rondada - 2</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Btl/Cia PM/Pel/Gp:</label>
                        <input type="text" id="opm2Unidade" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Munic√≠pio:</label>
                        <input type="text" id="opm2Municipio" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Hora Chegada:</label>
                        <input type="time" id="opm2Chegada" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Hora Sa√≠da:</label>
                        <input type="time" id="opm2Saida" onchange="updatePreview()">
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 10px;">
                    <label>1. Policiais de Servi√ßo:</label>
                    <textarea id="opm2Policiais" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>1.1. Apresenta√ß√£o pessoal e EPI:</label>
                    <textarea id="opm2Epi" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>2. √Årea externa:</label>
                    <textarea id="opm2AreaExterna" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>3. Servi√ßo de Dia:</label>
                    <textarea id="opm2ServicoDia" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>4. Reserva de armas:</label>
                    <textarea id="opm2ReservaArmas" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>5. Vesti√°rios:</label>
                    <textarea id="opm2Vestiarios" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>6. Copa/cozinha:</label>
                    <textarea id="opm2Copa" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>7. Garagens:</label>
                    <textarea id="opm2Garagens" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>8. √Årea de lazer:</label>
                    <textarea id="opm2Lazer" rows="2" onchange="updatePreview()"></textarea>
                </div>
                
                <div class="form-group">
                    <label>9. Outros/Observa√ß√µes:</label>
                    <textarea id="opm2Outros" rows="2" onchange="updatePreview()"></textarea>
                </div>
            </div>

            <!-- Ronda Programada 1 -->
            <div class="form-section">
                <h3>üöî Ronda a Programa de Policiamento - 1</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Hor√°rio:</label>
                        <input type="time" id="rp1Horario" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Viatura:</label>
                        <input type="text" id="rp1Viatura" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Km:</label>
                        <input type="text" id="rp1Km" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Local:</label>
                        <input type="text" id="rp1Local" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Enc RE:</label>
                        <input type="text" id="rp1EncRe" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Enc QRA:</label>
                        <input type="text" id="rp1EncQra" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>N¬∫ Arma Port√°til:</label>
                        <input type="text" id="rp1EncArma" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Mot RE:</label>
                        <input type="text" id="rp1MotRe" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Mot QRA:</label>
                        <input type="text" id="rp1MotQra" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Mot N¬∫ Arma:</label>
                        <input type="text" id="rp1MotArma" onchange="updatePreview()">
                    </div>
                </div>
                
                <div class="checkbox-grid" style="margin-top: 15px;">
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp1CppVtr" onchange="updatePreview()">
                        <label for="rp1CppVtr">1. CPP est√° na vtr?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp1CppAtualizado" onchange="updatePreview()">
                        <label for="rp1CppAtualizado">1.1. Est√° atualizado?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp1VtrLocal" onchange="updatePreview()">
                        <label for="rp1VtrLocal">2. Vtr est√° no local conforme CPP?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp1Tablet" onchange="updatePreview()">
                        <label for="rp1Tablet">3. Tablet (TMD) logado?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp1Conformidade" onchange="updatePreview()">
                        <label for="rp1Conformidade">4. CPP, RSO e TMD em conformidade?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp1Giroflex" onchange="updatePreview()">
                        <label for="rp1Giroflex">5. O giroflex estava acionado?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp1Produtividade" onchange="updatePreview()">
                        <label for="rp1Produtividade">6. RSO com produtividade anotada?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp1Treinamento" onchange="updatePreview()">
                        <label for="rp1Treinamento">7. Houve treinamento no prazo de 15 dias?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp1BoEletronico" onchange="updatePreview()">
                        <label for="rp1BoEletronico">8. Sabe elaborar BO PM Eletr√¥nico?</label>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 10px;">
                    <label>Observa√ß√µes complementares:</label>
                    <textarea id="rp1Obs" rows="2" onchange="updatePreview()"></textarea>
                </div>
            </div>

            <!-- Ronda Programada 2 -->
            <div class="form-section">
                <h3>üöî Ronda a Programa de Policiamento - 2</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Hor√°rio:</label>
                        <input type="time" id="rp2Horario" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Viatura:</label>
                        <input type="text" id="rp2Viatura" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Km:</label>
                        <input type="text" id="rp2Km" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Local:</label>
                        <input type="text" id="rp2Local" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Enc RE:</label>
                        <input type="text" id="rp2EncRe" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Enc QRA:</label>
                        <input type="text" id="rp2EncQra" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>N¬∫ Arma Port√°til:</label>
                        <input type="text" id="rp2EncArma" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Mot RE:</label>
                        <input type="text" id="rp2MotRe" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Mot QRA:</label>
                        <input type="text" id="rp2MotQra" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Mot N¬∫ Arma:</label>
                        <input type="text" id="rp2MotArma" onchange="updatePreview()">
                    </div>
                </div>
                
                <div class="checkbox-grid" style="margin-top: 15px;">
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp2CppVtr" onchange="updatePreview()">
                        <label for="rp2CppVtr">1. CPP est√° na vtr?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp2CppAtualizado" onchange="updatePreview()">
                        <label for="rp2CppAtualizado">1.1. Est√° atualizado?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp2VtrLocal" onchange="updatePreview()">
                        <label for="rp2VtrLocal">2. Vtr est√° no local conforme CPP?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp2Tablet" onchange="updatePreview()">
                        <label for="rp2Tablet">3. Tablet (TMD) logado?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp2Conformidade" onchange="updatePreview()">
                        <label for="rp2Conformidade">4. CPP, RSO e TMD em conformidade?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp2Giroflex" onchange="updatePreview()">
                        <label for="rp2Giroflex">5. O giroflex estava acionado?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp2Produtividade" onchange="updatePreview()">
                        <label for="rp2Produtividade">6. RSO com produtividade anotada?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp2Treinamento" onchange="updatePreview()">
                        <label for="rp2Treinamento">7. Houve treinamento no prazo de 15 dias?</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rp2BoEletronico" onchange="updatePreview()">
                        <label for="rp2BoEletronico">8. Sabe elaborar BO PM Eletr√¥nico?</label>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 10px;">
                    <label>Observa√ß√µes complementares:</label>
                    <textarea id="rp2Obs" rows="2" onchange="updatePreview()"></textarea>
                </div>
            </div>

            <!-- Documentos Elaborados -->
            <div class="form-section">
                <h3>üìÑ Documentos Elaborados</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Tipo/N√∫mero:</label>
                        <input type="text" id="docTipo" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Assunto:</label>
                        <input type="text" id="docAssunto" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Destino:</label>
                        <input type="text" id="docDestino" onchange="updatePreview()">
                    </div>
                </div>
            </div>

            <!-- Observa√ß√µes Gerais -->
            <div class="form-section">
                <h3>üìù Observa√ß√µes Gerais</h3>
                <div class="form-group">
                    <textarea id="obsGerais" rows="6" style="width: 100%;" onchange="updatePreview()"></textarea>
                </div>
            </div>

            <!-- Assinaturas -->
            <div class="form-section">
                <h3>‚úçÔ∏è Dados das Assinaturas</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Oficial Superior/Supervisor:</label>
                        <input type="text" id="assOficial" placeholder="Nome completo" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Data (Oficial):</label>
                        <input type="text" id="assDataOficial" placeholder="__/__/____" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Ch Div Op:</label>
                        <input type="text" id="assChDivOp" placeholder="Nome" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Data (Ch Div Op):</label>
                        <input type="text" id="assDataChDivOp" placeholder="__/__/____" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Ch EM CPI-10:</label>
                        <input type="text" id="assChEm" placeholder="Nome" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Data (Ch EM):</label>
                        <input type="text" id="assDataChEm" placeholder="__/__/____" onchange="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Destino Final:</label>
                        <input type="text" id="assDestino" placeholder="Ex: Arquivo/Se√ß√£o" onchange="updatePreview()">
                    </div>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn-primary" onclick="gerarRelatorio()">üëÅÔ∏è Visualizar Relat√≥rio Oficial</button>
                <button class="btn-success" onclick="salvarRascunhoFirebase()">üíæ Salvar no Firebase</button>
                <button class="btn-warning" onclick="limparFormulario()">üóëÔ∏è Limpar Tudo</button>
                <button class="btn-danger" onclick="window.print()">üñ®Ô∏è Imprimir / Salvar PDF</button>
            </div>

            <!-- Lista de Relat√≥rios do Usu√°rio -->
            <div class="saved-reports" id="savedReports">
                <h4>üìÇ Meus Relat√≥rios Salvos <span id="loadingIndicator" class="loading" style="display: none;"></span></h4>
                <div id="reportsList">
                    <div class="empty-state">
                        <p>Carregando relat√≥rios...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODO IMPRESS√ÉO -->
        <div class="print-mode" id="printMode">
            <div class="official-header">
                <div class="logo-area">
                    <div class="brasao-fallback">
                        BRAS√ÉO<br>PMESP
                    </div>
                </div>
                <div class="pm-text">
                    <div>POL√çCIA MILITAR</div>
                    <div>DO</div>
                    <div>ESTADO DE S√ÉO PAULO</div>
                </div>
                <div class="doc-title">
                    RELAT√ìRIO DE RONDA DO OFICIAL<br>
                    SUPERIOR/SUPERVISOR DO<br>
                    CPI-10
                </div>
            </div>

            <div class="date-line">
                Data: <span id="printData">____/____/________</span> - 
                Turno das <span id="printTurnoInicio">____:____</span> √†s <span id="printTurnoFim">____:____</span> horas
            </div>

            <table class="official-table">
                <tr>
                    <th>Viatura</th>
                    <th>Posto / Gradua√ß√£o</th>
                    <th>RE DC</th>
                    <th>Nome de Guerra</th>
                </tr>
                <tr>
                    <td id="printViatura" style="height: 25px;"></td>
                    <td id="printPostoGrad"></td>
                    <td id="printReDc"></td>
                    <td id="printNomeGuerra"></td>
                </tr>
                <tr>
                    <td>Km Final: <span id="printKmFinal"></span></td>
                    <td colspan="3">Enc: <span id="printEnc"></span></td>
                </tr>
                <tr>
                    <td>Km In√≠cio: <span id="printKmInicio"></span></td>
                    <td colspan="3">Mot: <span id="printMot"></span> - <span id="printMotNomeGuerra"></span></td>
                </tr>
                <tr>
                    <td>Km Percorrido: <span id="printKmPercorrido"></span></td>
                    <td colspan="3">Aux: <span id="printAux"></span> - <span id="printAuxNomeGuerra"></span></td>
                </tr>
            </table>

            <!-- OPM 1 -->
            <table class="official-table">
                <tr>
                    <th colspan="4" class="section-title">OPM RONDADA - 1</th>
                </tr>
                <tr>
                    <td style="width: 30%;"><strong>Btl/ Cia PM / Pel / Gp:</strong> <span id="printOp1Unidade"></span></td>
                    <td style="width: 30%;"><strong>Munic√≠pio:</strong> <span id="printOp1Municipio"></span></td>
                    <td style="width: 20%;"><strong>Hora de chegada:</strong> <span id="printOp1Chegada"></span></td>
                    <td style="width: 20%;"><strong>Hora de sa√≠da:</strong> <span id="printOp1Saida"></span></td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">1.</span> <span class="item-text"><strong>Policiais de Servi√ßo</strong> na base (Posto/Gradua√ß√£o / RE / Nome de guerra):<br>
                        <span id="printOp1Policiais"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">1.1.</span> <span class="item-text"><strong>Apresenta√ß√£o pessoal</strong> e <strong>EPI</strong> (mencionar eventuais altera√ß√µes e, nesse caso, se foi elaborado doc a respeito; lan√ßar o n√∫mero do colete bal√≠stico e do armamento em uso pelo policial do Sv Dia):<br>
                        <span id="printOp1Epi"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">2.</span> <span class="item-text"><strong>√Årea externa</strong> da OPM (observar itens como: pintura de fachada, estado de conserva√ß√£o do t√≥ten, pintura de paredes, portas e port√µes; ilumina√ß√£o externa; poda de √°rvores e √°reas verdes; funcionamento de torneiras em garagens e lavadores de vtrs; estado dos mastros das bandeiras; etc.):<br>
                        <span id="printOp1AreaExterna"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">3.</span> <span class="item-text"><strong>Servi√ßo de Dia</strong> e <strong>√°reas comuns internas</strong> (observar itens como: limpeza das √°reas comuns internas -- pisos, paredes, portas e vidros de vitr√¥s e janelas; pintura de paredes e portas internas; ilumina√ß√£o interna; se h√° materiais abandonados nos corredores ou quintais; etc.):<br>
                        <span id="printOp1ServicoDia"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">4.</span> <span class="item-text"><strong>Reserva de armas</strong> (observar se a reserva de armas est√° instalada em local seguro e se possui barreiras f√≠sicas que impe√ßam/dificultem o acesso de pessoas ao seu interior; se o armamento/muni√ß√£o est√° acondicionado em cofre e se este permanece devidamente trancado; se existe livro para controle de entrada e sa√≠da de armamento/muni√ß√£o e se √© conferido periodicamente pelo Cmt Cia/Gp, etc.):<br>
                        <span id="printOp1ReservaArmas"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">5.</span> <span class="item-text"><strong>Vesti√°rios</strong> (observar a conserva√ß√£o, a organiza√ß√£o e a limpeza de pisos, paredes, sanit√°rios, pias, portas e vidros; ilumina√ß√£o; se os arm√°rios est√£o identificados, se h√° materiais abandonados nos vesti√°rios, se as torneiras funcionam e se n√£o est√£o com vazamento, etc.):<br>
                        <span id="printOp1Vestiarios"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">6.</span> <span class="item-text"><strong>Copa/cozinha</strong> (observar a conserva√ß√£o, a organiza√ß√£o e a limpeza de pisos, paredes, pias, portas e vidros de vitr√¥s e janelas, eletrodom√©sticos -- geladeira, fog√£o, forno de microondas; ilumina√ß√£o; se as torneiras funcionam e se n√£o est√£o com vazamento, etc.):<br>
                        <span id="printOp1Copa"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">7.</span> <span class="item-text"><strong>Garagens</strong> (observar itens como: limpeza da √°rea da garagem e das viaturas estacionadas; ilumina√ß√£o; materiais abandonados; etc.):<br>
                        <span id="printOp1Garagens"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">8.</span> <span class="item-text"><strong>√Årea de lazer</strong> (citar o tipo de √°rea de lazer -- churrasqueira, piscina, quadra, etc.; observar itens como: pintura, estado de conserva√ß√£o dos itens el√©tricos e hidr√°ulicos; materiais abandonados; etc.):<br>
                        <span id="printOp1Lazer"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">9.</span> <span class="item-text">Outros itens julgados oportunos e pertinentes a serem relatados podem ser lan√ßados no campo "Observa√ß√µes".<br>
                        <span id="printOp1Outros"></span></span>
                    </td>
                </tr>
            </table>

            <!-- OPM 2 -->
            <table class="official-table">
                <tr>
                    <th colspan="4" class="section-title">OPM RONDADA - 2</th>
                </tr>
                <tr>
                    <td style="width: 30%;"><strong>Btl/ Cia PM / Pel / Gp:</strong> <span id="printOp2Unidade"></span></td>
                    <td style="width: 30%;"><strong>Munic√≠pio:</strong> <span id="printOp2Municipio"></span></td>
                    <td style="width: 20%;"><strong>Hora de chegada:</strong> <span id="printOp2Chegada"></span></td>
                    <td style="width: 20%;"><strong>Hora de sa√≠da:</strong> <span id="printOp2Saida"></span></td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">1.</span> <span class="item-text"><strong>Policiais de Servi√ßo</strong> na base (Posto/Gradua√ß√£o / RE / Nome de guerra):<br>
                        <span id="printOp2Policiais"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">1.1.</span> <span class="item-text"><strong>Apresenta√ß√£o pessoal</strong> e <strong>EPI</strong> (mencionar eventuais altera√ß√µes e, nesse caso, se foi elaborado doc a respeito; lan√ßar o n√∫mero do colete bal√≠stico e do armamento em uso pelo policial do Sv Dia):<br>
                        <span id="printOp2Epi"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">2.</span> <span class="item-text"><strong>√Årea externa</strong> da OPM (observar itens como: pintura de fachada, estado de conserva√ß√£o do t√≥ten, pintura de paredes e portas e port√µes; ilumina√ß√£o externa; poda de √°rvores e √°reas verdes; funcionamento de torneiras em garagens e lavadores de vtrs; estado dos mastros das bandeiras; etc.):<br>
                        <span id="printOp2AreaExterna"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">3.</span> <span class="item-text"><strong>Servi√ßo de Dia</strong> e <strong>√°reas comuns internas</strong> (observar itens como: limpeza das √°reas comuns internas -- pisos, paredes, portas e vidros de vitr√¥s e janelas; pintura de paredes e portas internas; ilumina√ß√£o interna; se h√° materiais abandonados nos corredores ou quintais; etc.):<br>
                        <span id="printOp2ServicoDia"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">4.</span> <span class="item-text"><strong>Reserva de armas</strong> (observar se a reserva de armas est√° instalada em local seguro e se possui barreiras f√≠sicas que impe√ßam/dificultem o acesso de pessoas ao seu interior; se o armamento/muni√ß√£o est√° acondicionado em cofre e se este permanece devidamente trancado; se existe livro para controle de entrada e sa√≠da de armamento/muni√ß√£o e se √© conferido periodicamente pelo Cmt Cia/Gp, etc.):<br>
                        <span id="printOp2ReservaArmas"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">5.</span> <span class="item-text"><strong>Vesti√°rios</strong> (observar a conserva√ß√£o, a organiza√ß√£o e a limpeza de pisos, paredes, sanit√°rios, pias, portas e vidros; ilumina√ß√£o; se os arm√°rios est√£o identificados, se h√° materiais abandonados nos vesti√°rios, se as torneiras funcionam e se n√£o est√£o com vazamento, etc.):<br>
                        <span id="printOp2Vestiarios"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">6.</span> <span class="item-text"><strong>Copa/cozinha</strong> (observar a conserva√ß√£o, a organiza√ß√£o e a limpeza de pisos, paredes, pias, portas e vidros de vitr√¥s e janelas, eletrodom√©sticos -- geladeira, fog√£o, forno de microondas; ilumina√ß√£o; se as torneiras funcionam e se n√£o est√£o com vazamento, etc.):<br>
                        <span id="printOp2Copa"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">7.</span> <span class="item-text"><strong>Garagens</strong> (observar itens como: limpeza da √°rea da garagem e das viaturas estacionadas; ilumina√ß√£o; materiais abandonados; etc.):<br>
                        <span id="printOp2Garagens"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">8.</span> <span class="item-text"><strong>√Årea de lazer</strong> (citar o tipo de √°rea de lazer -- churrasqueira, piscina, quadra, etc.; observar itens como: pintura, estado de conserva√ß√£o dos itens el√©tricos e hidr√°ulicos; materiais abandonados; etc.):<br>
                        <span id="printOp2Lazer"></span></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <span class="item-number">9.</span> <span class="item-text"><strong>Outros</strong> itens julgados oportunos e pertinentes a serem relatados podem ser lan√ßados no campo "Observa√ß√µes".<br>
                        <span id="printOp2Outros"></span></span>
                    </td>
                </tr>
            </table>

            <!-- Ronda Programada 1 -->
            <table class="official-table" style="font-size: 9pt;">
                <tr>
                    <th colspan="8" class="section-title">RONDA A PROGRAMA DE POLICIAMENTO - 1</th>
                </tr>
                <tr>
                    <th>Hor√°rio</th>
                    <th>Viatura</th>
                    <th>Km</th>
                    <th>Local</th>
                    <th colspan="2">Enc RE / QRA / N¬∫ arma port√°til</th>
                    <th colspan="2">Mot RE / QRA / N¬∫ arma port√°til</th>
                </tr>
                <tr style="text-align: center;">
                    <td id="printRp1Horario" style="height: 20px;"></td>
                    <td id="printRp1Viatura"></td>
                    <td id="printRp1Km"></td>
                    <td id="printRp1Local"></td>
                    <td colspan="2">
                        <span id="printRp1EncRe"></span> / 
                        <span id="printRp1EncQra"></span> / 
                        <span id="printRp1EncArma"></span>
                    </td>
                    <td colspan="2">
                        <span id="printRp1MotRe"></span> / 
                        <span id="printRp1MotQra"></span> / 
                        <span id="printRp1MotArma"></span>
                    </td>
                </tr>
                <tr style="font-size: 8.5pt;">
                    <td colspan="4" style="width: 50%;">
                        1. CPP est√° na vtr? <span id="printRp1CppVtr"></span><br>
                        1.1. Est√° atualizado? <span id="printRp1CppAtualizado"></span><br>
                        2. Vtr est√° no local conforme CPP? <span id="printRp1VtrLocal"></span><br>
                        3. Tablet (TMD) logado? <span id="printRp1Tablet"></span><br>
                        4. CPP, RSO e TMD est√£o em conformidade? <span id="printRp1Conformidade"></span>
                    </td>
                    <td colspan="4" style="width: 50%;">
                        5. O giroflex estava acionado? <span id="printRp1Giroflex"></span><br>
                        6. RSO com produtividade anotada? <span id="printRp1Produtividade"></span><br>
                        7. Houve treinamento no prazo de 15 dias? (POP, ICC,EAP, outros)? <span id="printRp1Treinamento"></span><br>
                        8. Sabe elaborar BO PM Eletr√¥nico? <span id="printRp1BoEletronico"></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="8">
                        <strong>Observa√ß√µes complementares:</strong><br>
                        <span id="printRp1Obs" style="min-height: 30px; display: block;"></span>
                    </td>
                </tr>
            </table>

            <!-- Ronda Programada 2 -->
            <table class="official-table" style="font-size: 9pt;">
                <tr>
                    <th colspan="8" class="section-title">RONDA A PROGRAMA DE POLICIAMENTO - 2</th>
                </tr>
                <tr>
                    <th>Hor√°rio</th>
                    <th>Viatura</th>
                    <th>Km</th>
                    <th>Local</th>
                    <th colspan="2">Enc RE / QRA / N¬∫ arma port√°til</th>
                    <th colspan="2">Mot RE / QRA / N¬∫ arma port√°til</th>
                </tr>
                <tr style="text-align: center;">
                    <td id="printRp2Horario" style="height: 20px;"></td>
                    <td id="printRp2Viatura"></td>
                    <td id="printRp2Km"></td>
                    <td id="printRp2Local"></td>
                    <td colspan="2">
                        <span id="printRp2EncRe"></span> / 
                        <span id="printRp2EncQra"></span> / 
                        <span id="printRp2EncArma"></span>
                    </td>
                    <td colspan="2">
                        <span id="printRp2MotRe"></span> / 
                        <span id="printRp2MotQra"></span> / 
                        <span id="printRp2MotArma"></span>
                    </td>
                </tr>
                <tr style="font-size: 8.5pt;">
                    <td colspan="4" style="width: 50%;">
                        1. CPP est√° na vtr? <span id="printRp2CppVtr"></span><br>
                        1.1. Est√° atualizado? <span id="printRp2CppAtualizado"></span><br>
                        2. Vtr est√° no local conforme CPP? <span id="printRp2VtrLocal"></span><br>
                        3. Tablet (TMD) logado? <span id="printRp2Tablet"></span><br>
                        4. CPP, RSO e TMD est√£o em conformidade? <span id="printRp2Conformidade"></span>
                    </td>
                    <td colspan="4" style="width: 50%;">
                        5. O giroflex estava acionado? <span id="printRp2Giroflex"></span><br>
                        6. RSO com produtividade anotada? <span id="printRp2Produtividade"></span><br>
                        7. Houve treinamento no prazo de 15 dias? (POP, ICC,EAP, outros)? <span id="printRp2Treinamento"></span><br>
                        8. Sabe elaborar BO PM Eletr√¥nico? <span id="printRp2BoEletronico"></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="8">
                        <strong>Observa√ß√µes complementares:</strong><br>
                        <span id="printRp2Obs" style="min-height: 30px; display: block;"></span>
                    </td>
                </tr>
            </table>

            <!-- Documentos Elaborados -->
            <table class="official-table">
                <tr>
                    <th colspan="3" class="section-title">DOCUMENTOS ELABORADOS</th>
                </tr>
                <tr>
                    <th style="width: 20%;">Tipo de Doc / N√∫mero</th>
                    <th style="width: 40%;">Assunto</th>
                    <th style="width: 40%;">Destino</th>
                </tr>
                <tr>
                    <td id="printDocTipo" style="height: 25px;"></td>
                    <td id="printDocAssunto"></td>
                    <td id="printDocDestino"></td>
                </tr>
            </table>

            <!-- Observa√ß√µes -->
            <div class="observations-box">
                <div class="observations-title">OBSERVA√á√ïES</div>
                <div class="observations-content" id="printObsGerais"></div>
            </div>

            <!-- Assinaturas -->
            <div class="signature-grid" style="margin-top: 20px; font-size: 9pt;">
                <div class="signature-box">
                    <div style="text-align: left; margin-bottom: 40px;">
                        Do Oficial Superior/Supervisor do CPI-10.<br>
                        Ao Sr Ch Div Op<br><br>
                        Encaminho o presente para conhecimento.
                    </div>
                    <div class="signature-line" id="printAssOficial"></div>
                    <div>Carimbo e assinatura</div>
                    <div style="margin-top: 10px;">Em <span id="printAssDataOficial">____/____/________</span></div>
                </div>
                
                <div class="signature-box">
                    <div style="text-align: left; margin-bottom: 40px;">
                        Do Ch Div OP<br>
                        Ao Sr Ch EM CPI-10
                    </div>
                    <div class="signature-line" id="printAssChDivOp"></div>
                    <div>Carimbo e assinatura</div>
                    <div style="margin-top: 10px;">Em <span id="printAssDataChDivOp">____/____/________</span></div>
                </div>
                
                <div class="signature-box">
                    <div style="text-align: left; margin-bottom: 40px;">
                        Do Ch EM CPI-10<br>
                        Ao <span id="printAssDestino">___________</span>.
                    </div>
                    <div class="signature-line" id="printAssChEm"></div>
                    <div>Carimbo e assinatura</div>
                    <div style="margin-top: 10px;">Em <span id="printAssDataChEm">____/____/________</span></div>
                </div>
            </div>
        </div>
    </div>

    <div class="sync-status" id="syncStatus">‚úì Sincronizado com Firebase</div>

    <script>
        // ==========================================
        // CONFIGURA√á√ÉO DO FIREBASE
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyDEGq9oTgi7JT-v-hGLHCOrZBMC5V8mY0M",
            authDomain: "relatorio-supervisor-4a508.firebaseapp.com",
            projectId: "relatorio-supervisor-4a508",
            storageBucket: "relatorio-supervisor-4a508.appspot.com",
            messagingSenderId: "305868632387",
            appId: "1:305868632387:web:2c0f95976b7efc54437ff6",
            measurementId: "G-SN5SGXYNRH"
        };

        try {
            firebase.initializeApp(firebaseConfig);
            console.log("‚úÖ Firebase inicializado");
        } catch (error) {
            console.error("‚ùå Erro Firebase:", error);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();

        // Vari√°veis globais
        let currentUser = null;
        let currentReportId = null;
        let isNewReport = true;

        // ==========================================
        // AUTENTICA√á√ÉO - ISOLAMENTO TOTAL
        // ==========================================

        auth.onAuthStateChanged((user) => {
            if (user) {
                // Verificar se √© troca de usu√°rio
                if (currentUser && currentUser.uid !== user.uid) {
                    console.log("üîÑ Troca de usu√°rio - limpando dados");
                    resetarTudo();
                }
                
                currentUser = user;
                console.log("‚úÖ Login:", user.uid);
                showApp();
                loadUserReports();
            } else {
                console.log("‚ÑπÔ∏è Logout");
                resetarTudo();
                showLogin();
            }
        });

        function resetarTudo() {
            currentUser = null;
            currentReportId = null;
            isNewReport = true;
            
            limparFormularioSilencioso();
            
            const reportsList = document.getElementById('reportsList');
            if (reportsList) {
                reportsList.innerHTML = '<div class="empty-state"><p>Fa√ßa login para ver seus relat√≥rios</p></div>';
            }
        }

        // ==========================================
        // BANCO DE DADOS - ISOLAMENTO POR UID
        // ==========================================

        async function loadUserReports() {
            if (!currentUser) {
                console.error("‚ùå Sem usu√°rio logado");
                return;
            }

            const loadingIndicator = document.getElementById('loadingIndicator');
            const reportsList = document.getElementById('reportsList');
            
            loadingIndicator.style.display = 'inline-block';
            reportsList.innerHTML = '<div class="empty-state"><p>Carregando...</p></div>';

            try {
                console.log("üîç Buscando relat√≥rios do usu√°rio:", currentUser.uid);
                
                const snapshot = await db.collection('reports')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .get();

                console.log("üìä Relat√≥rios deste usu√°rio:", snapshot.size);

                loadingIndicator.style.display = 'none';

                if (snapshot.empty) {
                    reportsList.innerHTML = `
                        <div class="empty-state">
                            <p>üì≠ Voc√™ ainda n√£o tem relat√≥rios salvos</p>
                            <p style="font-size: 0.9em; margin-top: 10px;">
                                Preencha o formul√°rio e clique em <strong>"Salvar no Firebase"</strong>
                            </p>
                        </div>
                    `;
                    return;
                }

                if (!currentUser) return;

                reportsList.innerHTML = snapshot.docs.map(doc => {
                    const data = doc.data();
                    
                    // Verifica√ß√£o extra de seguran√ßa
                    if (data.userId !== currentUser.uid) {
                        console.warn("‚ö†Ô∏è Relat√≥rio de outro usu√°rio filtrado:", doc.id);
                        return '';
                    }
                    
                    const date = data.dataRonda ? formatDate(data.dataRonda) : 'Sem data';
                    const title = data.viatura || 'Relat√≥rio sem viatura';
                    
                    return `
                        <div class="report-item">
                            <div class="report-info">
                                <div class="report-title">üöî ${title} - ${date}</div>
                                <div class="report-date">
                                    Criado em: ${data.createdAt ? new Date(data.createdAt.toDate()).toLocaleString('pt-BR') : 'Data desconhecida'}
                                </div>
                            </div>
                            <div class="report-actions">
                                <button class="btn-small btn-primary" onclick="carregarRelatorioFirebase('${doc.id}')">
                                    üìÇ Carregar
                                </button>
                                <button class="btn-small btn-danger" onclick="excluirRelatorioFirebase('${doc.id}')">
                                    üóëÔ∏è Excluir
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error("‚ùå Erro:", error);
                loadingIndicator.style.display = 'none';
                reportsList.innerHTML = `
                    <div class="empty-state" style="color: #dc3545;">
                        <p>‚ùå Erro ao carregar seus relat√≥rios</p>
                        <button onclick="loadUserReports()" style="margin-top: 10px;">üîÑ Tentar novamente</button>
                    </div>
                `;
            }
        }

        function showLogin() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
        }

        function showApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            document.getElementById('editMode').style.display = 'block';
            
            // OCULTO: UID n√£o exibido na interface - apenas nome e email
            document.getElementById('userName').textContent = currentUser.displayName || 'Usu√°rio';
            document.getElementById('userEmail').textContent = currentUser.email;
            // UID mantido no elemento mas oculto via CSS (display: none)
            document.getElementById('userUid').textContent = currentUser.uid;
            
            // Sempre come√ßar com formul√°rio limpo
            limparFormularioSilencioso();
            
            // Definir data atual
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('dataRonda').value = hoje;
        }

        // ==========================================
        // LIMPEZA TOTAL - ISOLAMENTO GARANTIDO
        // ==========================================

        function limparFormularioSilencioso() {
            formFields.forEach(field => {
                const element = document.getElementById(field);
                if (element) element.value = '';
            });
            
            checkboxFields.forEach(field => {
                const element = document.getElementById(field);
                if (element) element.checked = false;
            });
            
            currentReportId = null;
            isNewReport = true;
            
            updateStatusIndicator();
            
            calcularKm();
            updatePreview();
            
            console.log("üßπ Formul√°rio limpo");
        }

        function updateStatusIndicator() {
            const indicator = document.getElementById('reportStatusIndicator');
            if (!indicator) return;
            
            if (isNewReport) {
                indicator.className = 'report-status';
                indicator.innerHTML = 'üìù <strong>Novo Relat√≥rio</strong> - Preencha os dados abaixo';
            } else {
                indicator.className = 'report-status editing';
                indicator.innerHTML = `‚úèÔ∏è <strong>Editando Relat√≥rio</strong> - ID: ${currentReportId.substring(0, 12)}...`;
            }
        }

        // ==========================================
        // AUTENTICA√á√ÉO
        // ==========================================

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            
            if (!email || !password) {
                errorDiv.textContent = 'Preencha email e senha';
                errorDiv.style.display = 'block';
                return;
            }

            errorDiv.style.display = 'none';
            
            auth.signInWithEmailAndPassword(email, password)
                .catch((error) => {
                    errorDiv.textContent = getErrorMessage(error.code);
                    errorDiv.style.display = 'block';
                });
        }

        function register() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            
            if (!email || !password) {
                errorDiv.textContent = 'Preencha email e senha';
                errorDiv.style.display = 'block';
                return;
            }

            if (password.length < 6) {
                errorDiv.textContent = 'Senha deve ter no m√≠nimo 6 caracteres';
                errorDiv.style.display = 'block';
                return;
            }

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    return db.collection('users').doc(userCredential.user.uid).set({
                        email: email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        displayName: email.split('@')[0],
                        userId: userCredential.user.uid
                    });
                })
                .catch((error) => {
                    errorDiv.textContent = getErrorMessage(error.code);
                    errorDiv.style.display = 'block';
                });
        }

        function logout() {
            resetarTudo();
            auth.signOut();
        }

        function getErrorMessage(code) {
            const errors = {
                'auth/invalid-email': 'Email inv√°lido',
                'auth/user-disabled': 'Usu√°rio desativado',
                'auth/user-not-found': 'Usu√°rio n√£o encontrado',
                'auth/wrong-password': 'Senha incorreta',
                'auth/email-already-in-use': 'Email j√° cadastrado',
                'auth/weak-password': 'Senha muito fraca',
                'auth/invalid-credential': 'Email ou senha incorretos'
            };
            return errors[code] || 'Erro ao autenticar';
        }

        // ==========================================
        // CRUD COM SEGURAN√áA M√ÅXIMA
        // ==========================================

        async function salvarRascunhoFirebase() {
            if (!currentUser) {
                alert('Voc√™ precisa estar logado');
                return;
            }

            const formData = collectFormData();
            
            if (!formData.dataRonda) {
                alert('Preencha pelo menos a data da ronda');
                return;
            }

            const reportData = {
                userId: currentUser.uid,
                userEmail: currentUser.email,
                ...formData,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                if (currentReportId) {
                    const docRef = db.collection('reports').doc(currentReportId);
                    const doc = await docRef.get();
                    
                    if (!doc.exists) {
                        alert('Relat√≥rio n√£o encontrado');
                        return;
                    }
                    
                    if (doc.data().userId !== currentUser.uid) {
                        console.error("üö´ Tentativa n√£o autorizada de edi√ß√£o:", currentReportId);
                        alert('Voc√™ n√£o tem permiss√£o para editar este relat√≥rio');
                        return;
                    }

                    await docRef.update(reportData);
                    showSyncStatus('‚úì Relat√≥rio atualizado');
                } else {
                    reportData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    const docRef = await db.collection('reports').add(reportData);
                    currentReportId = docRef.id;
                    isNewReport = false;
                    updateStatusIndicator();
                    showSyncStatus('‚úì Relat√≥rio salvo');
                }

                loadUserReports();
            } catch (error) {
                console.error('‚ùå Erro ao salvar:', error);
                alert('Erro ao salvar: ' + error.message);
            }
        }

        async function carregarRelatorioFirebase(reportId) {
            if (!currentUser) {
                alert('Fa√ßa login primeiro');
                return;
            }

            try {
                const doc = await db.collection('reports').doc(reportId).get();
                
                if (!doc.exists) {
                    alert('Relat√≥rio n√£o encontrado');
                    return;
                }

                const data = doc.data();
                
                if (data.userId !== currentUser.uid) {
                    console.error("üö´ Acesso negado ao relat√≥rio:", reportId);
                    alert('Acesso negado: Este relat√≥rio n√£o pertence a voc√™');
                    return;
                }

                populateForm(data);
                currentReportId = reportId;
                isNewReport = false;
                updateStatusIndicator();
                
                showSyncStatus('‚úì Relat√≥rio carregado');
                window.scrollTo(0, 0);

            } catch (error) {
                console.error('‚ùå Erro ao carregar:', error);
                alert('Erro ao carregar relat√≥rio');
            }
        }

        async function excluirRelatorioFirebase(reportId) {
            if (!confirm('Tem certeza que deseja excluir este relat√≥rio permanentemente?')) {
                return;
            }

            if (!currentUser) {
                alert('Fa√ßa login primeiro');
                return;
            }

            try {
                const doc = await db.collection('reports').doc(reportId).get();
                
                if (!doc.exists) {
                    alert('Relat√≥rio n√£o encontrado');
                    return;
                }
                
                if (doc.data().userId !== currentUser.uid) {
                    console.error("üö´ Tentativa n√£o autorizada de exclus√£o:", reportId);
                    alert('Voc√™ n√£o tem permiss√£o para excluir este relat√≥rio');
                    return;
                }

                await db.collection('reports').doc(reportId).delete();
                
                if (currentReportId === reportId) {
                    limparFormularioSilencioso();
                    const hoje = new Date().toISOString().split('T')[0];
                    document.getElementById('dataRonda').value = hoje;
                }

                showSyncStatus('‚úì Relat√≥rio exclu√≠do');
                loadUserReports();

            } catch (error) {
                console.error('‚ùå Erro ao excluir:', error);
                alert('Erro ao excluir relat√≥rio');
            }
        }

        // ==========================================
        // FUN√á√ïES AUXILIARES
        // ==========================================

        function collectFormData() {
            const data = {};
            
            formFields.forEach(field => {
                const element = document.getElementById(field);
                if (element) data[field] = element.value;
            });

            checkboxFields.forEach(field => {
                const element = document.getElementById(field);
                if (element) data[field] = element.checked;
            });

            return data;
        }

        function populateForm(data) {
            formFields.forEach(field => {
                const element = document.getElementById(field);
                if (element && data[field] !== undefined) {
                    element.value = data[field];
                }
            });

            checkboxFields.forEach(field => {
                const element = document.getElementById(field);
                if (element && data[field] !== undefined) {
                    element.checked = data[field];
                }
            });

            calcularKm();
            updatePreview();
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const [ano, mes, dia] = dateString.split('-');
            return `${dia}/${mes}/${ano}`;
        }

        function showSyncStatus(message) {
            const status = document.getElementById('syncStatus');
            status.textContent = message;
            status.classList.add('show');
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        // ==========================================
        // FORMUL√ÅRIO E UI
        // ==========================================

        const formFields = [
            'dataRonda', 'turnoInicio', 'turnoFim', 'viatura', 'postoGrad', 'reDc', 'nomeGuerra',
            'kmInicio', 'kmFinal', 'motRe', 'motNomeGuerra', 'auxRe', 'auxNomeGuerra',
            'opm1Unidade', 'opm1Municipio', 'opm1Chegada', 'opm1Saida', 'opm1Policiais', 'opm1Epi',
            'opm1AreaExterna', 'opm1ServicoDia', 'opm1ReservaArmas', 'opm1Vestiarios', 'opm1Copa',
            'opm1Garagens', 'opm1Lazer', 'opm1Outros',
            'opm2Unidade', 'opm2Municipio', 'opm2Chegada', 'opm2Saida', 'opm2Policiais', 'opm2Epi',
            'opm2AreaExterna', 'opm2ServicoDia', 'opm2ReservaArmas', 'opm2Vestiarios', 'opm2Copa',
            'opm2Garagens', 'opm2Lazer', 'opm2Outros',
            'rp1Horario', 'rp1Viatura', 'rp1Km', 'rp1Local', 'rp1EncRe', 'rp1EncQra', 'rp1EncArma',
            'rp1MotRe', 'rp1MotQra', 'rp1MotArma', 'rp1Obs',
            'rp2Horario', 'rp2Viatura', 'rp2Km', 'rp2Local', 'rp2EncRe', 'rp2EncQra', 'rp2EncArma',
            'rp2MotRe', 'rp2MotQra', 'rp2MotArma', 'rp2Obs',
            'docTipo', 'docAssunto', 'docDestino', 'obsGerais',
            'assOficial', 'assDataOficial', 'assChDivOp', 'assDataChDivOp', 'assChEm', 'assDataChEm', 'assDestino'
        ];

        const checkboxFields = [
            'rp1CppVtr', 'rp1CppAtualizado', 'rp1VtrLocal', 'rp1Tablet', 'rp1Conformidade',
            'rp1Giroflex', 'rp1Produtividade', 'rp1Treinamento', 'rp1BoEletronico',
            'rp2CppVtr', 'rp2CppAtualizado', 'rp2VtrLocal', 'rp2Tablet', 'rp2Conformidade',
            'rp2Giroflex', 'rp2Produtividade', 'rp2Treinamento', 'rp2BoEletronico'
        ];

        document.getElementById('kmInicio').addEventListener('input', calcularKm);
        document.getElementById('kmFinal').addEventListener('input', calcularKm);

        function calcularKm() {
            const inicio = parseFloat(document.getElementById('kmInicio').value) || 0;
            const fim = parseFloat(document.getElementById('kmFinal').value) || 0;
            const percorrido = fim - inicio;
            document.getElementById('kmPercorrido').value = percorrido >= 0 ? percorrido : 0;
            updatePreview();
        }

        function updatePreview() {
            formFields.forEach(field => {
                const element = document.getElementById(field);
                const printElement = document.getElementById('print' + field.charAt(0).toUpperCase() + field.slice(1));
                if (element && printElement) {
                    printElement.textContent = element.value || '';
                }
            });

            const dataRonda = document.getElementById('dataRonda').value;
            if (dataRonda) {
                const [ano, mes, dia] = dataRonda.split('-');
                document.getElementById('printData').textContent = `${dia}/${mes}/${ano}`;
            }

            checkboxFields.forEach(field => {
                const checkbox = document.getElementById(field);
                const printElement = document.getElementById('print' + field.charAt(0).toUpperCase() + field.slice(1));
                if (checkbox && printElement) {
                    printElement.innerHTML = checkbox.checked ? 
                        '<span style="color: black; font-weight: bold;">( X ) Sim&nbsp;&nbsp;( &nbsp;&nbsp; ) N√£o</span>' : 
                        '<span style="color: black;">( &nbsp;&nbsp; ) Sim&nbsp;&nbsp;( &nbsp;&nbsp; ) N√£o</span>';
                }
            });

            document.getElementById('printKmPercorrido').textContent = document.getElementById('kmPercorrido').value;
            document.getElementById('printEnc').textContent = document.getElementById('nomeGuerra').value;
            document.getElementById('printMot').textContent = document.getElementById('motRe').value;
            document.getElementById('printAux').textContent = document.getElementById('auxRe').value;
            
            const printMotNome = document.getElementById('printMotNomeGuerra');
            const printAuxNome = document.getElementById('printAuxNomeGuerra');
            if (printMotNome) printMotNome.textContent = document.getElementById('motNomeGuerra').value || '';
            if (printAuxNome) printAuxNome.textContent = document.getElementById('auxNomeGuerra').value || '';
        }

        function gerarRelatorio() {
            updatePreview();
            document.getElementById('editMode').style.display = 'none';
            document.getElementById('printMode').style.display = 'block';
            window.scrollTo(0, 0);
            
            const btnVoltar = document.createElement('button');
            btnVoltar.innerHTML = '‚úèÔ∏è Voltar √† Edi√ß√£o';
            btnVoltar.className = 'btn-warning no-print';
            btnVoltar.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.3);';
            btnVoltar.onclick = function() {
                document.getElementById('editMode').style.display = 'block';
                document.getElementById('printMode').style.display = 'none';
                this.remove();
            };
            document.body.appendChild(btnVoltar);
        }

        function limparFormulario() {
            if (confirm('Deseja limpar todos os campos e come√ßar um novo relat√≥rio?')) {
                limparFormularioSilencioso();
                const hoje = new Date().toISOString().split('T')[0];
                document.getElementById('dataRonda').value = hoje;
            }
        }
    </script>
</body>
</html>
